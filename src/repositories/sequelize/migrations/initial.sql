CREATE TABLE podcasts (id UUID PRIMARY KEY, "feedURL" TEXT NOT NULL UNIQUE, "imageURL" TEXT, summary TEXT, title TEXT, author TEXT, "lastBuildDate" TIMESTAMP, "lastPubDate" TIMESTAMP, "dateCreated" TIMESTAMP NOT NULL, "lastUpdated" TIMESTAMP NOT NULL, UNIQUE ("feedURL"));
CREATE TABLE episodes (id SERIAL PRIMARY KEY, "mediaURL" TEXT NOT NULL UNIQUE, "imageURL" TEXT, title TEXT, summary TEXT, duration INTEGER, link TEXT, "mediaBytes" INTEGER, "mediaType" TEXT, "pubDate" TIMESTAMP, "dateCreated" TIMESTAMP NOT NULL, "lastUpdated" TIMESTAMP NOT NULL, "podcastId" UUID REFERENCES podcasts (id) ON DELETE SET NULL ON UPDATE CASCADE, UNIQUE ("mediaURL"));
CREATE TABLE "mediaRefs" (id UUID PRIMARY KEY, "startTime" INTEGER NOT NULL DEFAULT 0, "endTime" INTEGER, title TEXT, description TEXT, "ownerId" TEXT, "ownerName" TEXT, "dateCreated" TIMESTAMP, "lastUpdated" TIMESTAMP, "episodeId" INTEGER NOT NULL REFERENCES episodes (id) ON DELETE NO ACTION ON UPDATE CASCADE);
CREATE TABLE playlists (id UUID PRIMARY KEY, slug TEXT UNIQUE, title TEXT NOT NULL, "ownerId" TEXT NOT NULL, "ownerName" TEXT, "dateCreated" TIMESTAMP, "lastUpdated" TIMESTAMP, "sharePermission" TEXT, "isRecommendation" BOOLEAN NOT NULL DEFAULT FALSE, "isMyClips" BOOLEAN NOT NULL DEFAULT FALSE, UNIQUE (slug));
CREATE TABLE users (id VARCHAR(255) PRIMARY KEY, name TEXT, "createdAt" TIMESTAMP NOT NULL, "updatedAt" TIMESTAMP NOT NULL);
CREATE TABLE "playlistItems" ("dateCreated" TIMESTAMP NOT NULL, "lastUpdated" TIMESTAMP NOT NULL, "playlistId" UUID NOT NULL REFERENCES playlists (id) ON DELETE CASCADE ON UPDATE CASCADE, "mediaRefId" UUID NOT NULL REFERENCES "mediaRefs" (id) ON DELETE CASCADE ON UPDATE CASCADE, PRIMARY KEY ("playlistId", "mediaRefId"));
CREATE TABLE "subscribedPodcasts" ("createdAt" TIMESTAMP NOT NULL, "updatedAt" TIMESTAMP NOT NULL, "userId" VARCHAR(255) NOT NULL REFERENCES users (id) ON DELETE CASCADE ON UPDATE CASCADE, "podcastId" UUID NOT NULL REFERENCES podcasts (id) ON DELETE CASCADE ON UPDATE CASCADE, PRIMARY KEY ("userId", "podcastId"));
CREATE TABLE "subscribedPlaylists" ("createdAt" TIMESTAMP NOT NULL, "updatedAt" TIMESTAMP NOT NULL, "userId" VARCHAR(255) NOT NULL REFERENCES users (id) ON DELETE CASCADE ON UPDATE CASCADE, "playlistId" UUID NOT NULL REFERENCES playlists (id) ON DELETE CASCADE ON UPDATE CASCADE, PRIMARY KEY ("userId", "playlistId"));
