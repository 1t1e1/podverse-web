{% if mediaRefs|isPlaylist %}
  <hr />
  <div id="playlist">
    {% if isSubscribed %}
      <div id="playlist-subscribe" class="text-primary" title="Unsave playlist"><i class="fa fa-star"></i> saved</div>
    {% else %}
      <div id="playlist-subscribe" title="Save playlist">save</div>
    {% endif %}
    <div id="playlist-title">
      {% if isRecommendation %}
        Recommended for {{ title }}
      {% else %}
        <i class="fa fa-list-ul"></i> {{ title }}
      {% endif %}
    </div>
    <div id="playlist-subtitle">
      From: {{ ownerName }}
    </div>
    {% for item in mediaRefs %}
      {% if item|isEpisode %}
        <div class="playlist-item">
          <div class="playlist-item-inner">
            <div class="playlist-item-image">
              <img src="{{ item.episode.podcast.imageURL }}">
            </div>
            <div class="playlist-item-text-wrapper">
              <div class="playlist-item-podcast-title">
                {{ item.episode.podcast.title }}
              </div>
              <div class="playlist-item-sub-title">
                {{ item.episode.title }}
              </div>
              <div class="playlist-item-time">
                  Full Episode â€“ {{ item.episode.duration | convertSecToHHMMSS }}
              </div>
            </div><!-- /.playlist-item-text-wrapper -->
            {% if item.episode.summary %}
              <div class="playlist-item-details">
                {{ item.episode.summary }}
              </div>
            {% endif %}
            <div style="clear:both"></div>
          </div><!-- /.playlist-item-inner -->
        </div><!-- /.playlist-item -->
      {% else %} <!-- else treat it as an episode -->
        <div class="playlist-item">
          <div class="playlist-item-inner">
            <div class="playlist-item-image">
              <img src="{{ item.episode.podcast.imageURL }}">
            </div>
            <div class="playlist-item-text-wrapper">
              <div class="playlist-item-podcast-title">
                {{ item.episode.podcast.title }}
              </div>
              <div class="playlist-item-sub-title">
                {{ item.episode.title }}
              </div>
              <div class="playlist-item-time">
                {{ item.startTime | convertSecToHHMMSS }}
                {% if item.endTime %}
                  to {{ item.endTime | convertSecToHHMMSS }}
                {% endif %}
              </div>
            </div><!-- /.playlist-item-text-wrapper -->
            {% if item.description %}
              <div class="playlist-item-details">
                {{ item.description }}
              </div>
            {% endif %}
            <div style="clear:both"></div>
          </div><!-- /.playlist-item-inner -->
        </div><!-- /.playlist-item -->
      {% endif %}
    {% endfor %}
  </div><!-- /#playlist -->
{% endif %}

<script>
window.playlistId = '{{ id }}';

$('#playlist-subscribe').on('click', function () {
  if ($(this).html() === 'save') {
    $('#playlist-subscribe').html('<i class="fa fa-star"></i> saved');
    $('#playlist-subscribe').attr('title', 'Unsave playlist');
    $('#playlist-subscribe').addClass('text-primary');
    subscribeToPlaylist(playlistId);
  } else {
    $('#playlist-subscribe').html('save');
    $('#playlist-subscribe').attr('title', 'Save playlist');
    $('#playlist-subscribe').removeClass('text-primary');
    unsubscribeFromPlaylist(playlistId);
  }
});
</script>
